{% extends 'layout.html' %}

{% block additional_header_imports %}
		<script src="https://d3js.org/d3.v5.min.js" crossorigin="anonymous"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" crossorigin="anonymous">
{% endblock %}
		
<!--
 https://stackoverflow.com/questions/29063244/consistent-styling-for-nested-lists-with-bootstrap
-->
		
{% block inline_style %}

<style>
.just-padding {
    padding: 15px;
}

.list-group.list-group-root {
    padding: 0;
    /*overflow: hidden;*/
}

.list-group.list-group-root .list-group {
    margin-bottom: 0;
}

.list-group.list-group-root .list-group-item {
    border-radius: 0;
    border-width: 1px 0 0 0;
}

/*
.list-group.list-group-root > .list-group-item:first-child {
    border-top-width: 0;
}
*/

.list-group.list-group-root > .list-group > .list-group-item {
    padding-left: 30px;
}

.list-group.list-group-root > .list-group > .list-group > .list-group-item {
    padding-left: 45px;
}

.list-group.list-group-root > .list-group > .list-group > .list-group > .list-group-item {
    padding-left: 60px;
}

.list-group.list-group-root > .list-group > .list-group > .list-group >  .list-group > .list-group-item {
    padding-left: 75px;
}

.list-group-item .fa {
    margin-right: 5px;
}


.collapse {
  /*display: none;*/
  &.show {
    display: block;
  }
}

</style>

{% endblock %}
	
{% block body %}

<body>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">Checkin</a>
  
  <form class="form-inline">
	<input type="datetime-local" name="datetime" id="datetime" class="form-control mr-sm-2">
    <button class="btn btn-outline-success my-2 my-sm-0" type="submit" id="submitData">Submit</button>
  </form>
  
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav">
      <a class="nav-item nav-link active" href="#">Home <span class="sr-only">(current)</span></a>
      <a class="nav-item nav-link" href="#">Features</a>
      <a class="nav-item nav-link" href="#">Pricing</a>
      <a class="nav-item nav-link disabled" href="#">Disabled</a>
    </div>
  </div>
  
</nav>


<div class="just-padding">
  <div class="list-group list-group-root well">
	{%- for item in data_tree recursive %}
		{%- if item.obj %}
		<div class="container">
		<div class="row">
		<div class=".col-xs-12">
			<a href="#
				{%- if item.children -%}
				x{{ item.id }}
				{%- endif -%}
			" class="list-group-item list-group-item-action 
				{%- if item.children %} " data-toggle="collapse
				{%- endif -%}
			">

				{%- if item.children %}
				<i class="fa fa-caret-right"></i>
				{%- endif %}
			{{- item.obj.name }}
			</a>
		</div>
		{%- if item.obj.is_checkinable -%}
			{% for i in range(1,6) %}
				<div class=".col-xs-12 form-check form-check-inline">
				  <input class="form-check-input" type="radio" name="inlineRadio{{ item.obj.id }}" id="inlineRadio{{ item.obj.id }}{{ i }}" value="{{ i }}" data-eventTypeId="{{ item.obj.id }}">
				  <label class="form-check-label" for="inlineRadio{{ item.obj.id }}{{ i }}">{{ i }}</label>
				</div>
		    {% endfor %}
		{%- endif -%} <!--if item.obj.is_checkinable-->
		</div>
		</div>
			
		{%- endif %} <!-- if item.obj -->
		
		{%- if item.children %}
		<div class="list-group collapse" id="x{{ item.id }}">
			{{ loop(item.children) }}
		</div>
		{% endif %} <!-- if item.children --> 
	{%- endfor %}
  </div>
</div>  

<script>

//https://stackoverflow.com/questions/29063244/consistent-styling-for-nested-lists-with-bootstrap

$(function() {
        
  $('.list-group-item').on('click', function() {
    $('.fa', this)
      .toggleClass('fa-caret-right')
      .toggleClass('fa-caret-down');
  });

});

//$('.collapse').collapse();

///////////////////////////////////////////////////

var default_date = new Date();
default_date.setMinutes(default_date.getMinutes() - default_date.getTimezoneOffset())
d3.selectAll('input#datetime').attr('value', default_date.toJSON().slice(0,19));

///////////////////////////////////////////////////


function _sendJSON(){ 
    
	console.log("_sendJSON() activated");
	//console.log(this.dataset.eventTypeId);
	//console.log(this);
	const timestamp = new Date(d3.select('input#datetime').node().value);
	
	let payload = {"timestamp": timestamp };
	
	
	const radios = d3.selectAll("input[name^='inlineRadio']:checked");
	let items = $("input[name^='inlineRadio']:checked").serializeArray();
	items.map(d => d['eventTypeId'] = d['name'].slice(11));
	payload['items'] = items;
	console.log("Payload", payload);
	
	//let event_type_id = $(this).attr("data-eventTypeId");
	//console.log(event_type_id);
	
	
	
	//let modal = d3.select('#checkinModal_' + event_type_id);
	//let comments = modal.select('input#comments').node().value;
	//let value = modal.select('input#value').node().value;
	

	/*

	let xhr = new XMLHttpRequest(); 
	let url = "/checkin/"; 

	//let payload = {"event_type": $(this).attr("data-eventTypeId") };
	let payload = {"event_type": event_type_id,
				   "timestamp": timestamp };


	{% for var_name in ("value", "comments") %}
		Object.assign(payload, ({{ var_name }}.length > 0) && { "{{ var_name }}" : {{ var_name }} });
	{% endfor %}

	console.log(payload);

	var data = JSON.stringify(payload);
	
	console.log(data);
	
	xhr.open("POST", url, true); 
	xhr.setRequestHeader("Content-Type", "application/json"); 
	xhr.send(data); 
	
	*/
	
}

$("button#submitData").click(this, _sendJSON);



</script>

{% endblock %}